<!DOCTYPE html>
<html lang='zh-cn'>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compiler & OS DashBoard on WebAssembly - 中断处理</title>
    <link rel="stylesheet" href="/assets/lib/layui@2.11.4/css/layui.css">
    <link id="layui_theme" rel="stylesheet" href="/assets/lib/layui@2.11.4/css/layui-dark.css">
    <link rel="stylesheet" href="/assets/lib/codemirror@5.65.18/lib/codemirror.css">
    <link rel="stylesheet" href="/assets/lib/codemirror@5.65.18/theme/material-palenight.css">
    <link rel="stylesheet" href="/assets/lib/codemirror@5.65.18/theme/solarized.css">

    <link id="markdown_theme" rel="stylesheet" href="/assets/css/markdown.css">
    <link id="highlight_theme" rel="stylesheet" href="/assets/lib/highlight@10.7.3/styles/atom-one-dark.css">

    <link rel="stylesheet" href="/assets/css/interrupt.css">

</head>

<body>

    <div class="layui-nav layui-nav-child-l " style="background-color: rgb(41, 46, 80);">
        <li class="layui-nav-item layui-this">
            <a href="javascript:;" class="layui-icon layui-icon-fonts-code">中断处理演示</a>
        </li>
        <li class="layui-nav-item">
            <a href="javascript:;" class="layui-icon layui-icon-read" lay-on="iframe">参考手册</a>
        </li>
        <li class="layui-nav-item">
            <a href="javascript:this_html.editor_run();" class="layui-icon layui-icon-play">运行演示</a>
        </li>
        <li class="layui-nav-item">
            <a href="javascript:this_html.init_interrupt_system();" class="layui-icon layui-icon-component">初始化系统</a>
        </li>
        <li class="layui-nav-item">
            <a href="javascript:this_html.demo_priorities();" class="layui-icon layui-icon-component">优先级演示</a>
        </li>
        <li class="layui-nav-item">
            <a href="javascript:this_html.demo_exceptions();" class="layui-icon layui-icon-component">异常处理</a>
        </li>
        <li class="layui-nav-item">
            <a href="javascript:this_html.editor_clear();" class="layui-icon layui-icon-clear">清空输出</a>
        </li>

        <li class="layui-nav-item">
            <a href="javascript:location.reload(true);" class="layui-icon layui-icon-refresh-3">刷新页面</a>
        </li>
        <li class="layui-nav-item">
            <a href="javascript:;" class="layui-icon layui-icon-fonts-code">示例代码</a>
            <dl class="layui-nav-child">
                <dd>
                    <a href="javascript:this_html.loadscript('interrupt-demo1.els');">基础中断模拟</a>
                    <a href="javascript:this_html.loadscript('interrupt-demo2.els');">中断优先级</a>
                    <a href="javascript:this_html.loadscript('interrupt-demo3.els');">异常处理</a>
                </dd>
            </dl>
        </li>
        <li class="layui-nav-item ">
            <a href="javascript:this_html.toggle_theme();" id='layui_theme_btn'
                class="layui-icon layui-icon-theme">切换主题</a>
        </li>
    </div>

    <!-- 中断操作控制面板 -->
    <div class="interrupt-controls">
        <div class="operation-section">
            <div class="operation-title">🎯 Losu VM信号</div>
            <button class="layui-btn layui-btn-sm layui-btn-normal" onclick="this_html.trigger_interrupt(1)" title="losu_signal_done - 程序正常完成">
                <i class="layui-icon layui-icon-ok"></i> DONE
            </button>
            <button class="layui-btn layui-btn-sm layui-btn-danger" onclick="this_html.trigger_interrupt(2)" title="losu_signal_error - 执行错误">
                <i class="layui-icon layui-icon-close"></i> ERROR
            </button>
            <button class="layui-btn layui-btn-sm layui-btn-warm" onclick="this_html.trigger_interrupt(3)" title="losu_signal_yield - 协程让步">
                <i class="layui-icon layui-icon-pause"></i> YIELD
            </button>
            <button class="layui-btn layui-btn-sm layui-btn-danger" onclick="this_html.trigger_interrupt(4)" title="losu_signal_kill - 强制终止">
                <i class="layui-icon layui-icon-delete"></i> KILL
            </button>
        </div>
        
        <div class="operation-section">
            <div class="operation-title">⚡ 系统中断</div>
            <button class="layui-btn layui-btn-sm layui-btn-warm" onclick="this_html.trigger_interrupt(5)">
                <i class="layui-icon layui-icon-time"></i> TIMER
            </button>
            <button class="layui-btn layui-btn-sm layui-btn-normal" onclick="this_html.trigger_interrupt(6)">
                <i class="layui-icon layui-icon-file"></i> I/O
            </button>
            <button class="layui-btn layui-btn-sm layui-btn-warm" onclick="this_html.trigger_interrupt(7)">
                <i class="layui-icon layui-icon-component"></i> MEMORY
            </button>
            <button class="layui-btn layui-btn-sm layui-btn-normal" onclick="this_html.trigger_interrupt(8)">
                <i class="layui-icon layui-icon-set"></i> SYSCALL
            </button>
        </div>
        
        <div class="operation-section">
            <div class="operation-title">🎮 程序控制</div>
            <button class="layui-btn layui-btn-sm layui-btn-normal" onclick="this_html.start_long_program(100)">
                <i class="layui-icon layui-icon-play"></i> 启动程序(100步)
            </button>
            <button class="layui-btn layui-btn-sm layui-btn-warm" onclick="this_html.start_long_program(200)">
                <i class="layui-icon layui-icon-play"></i> 启动程序(200步)
            </button>
            <button class="layui-btn layui-btn-sm layui-btn-danger" onclick="this_html.force_stop()">
                <i class="layui-icon layui-icon-pause"></i> 强制停止
            </button>
        </div>

        <div class="operation-section">
            <div class="operation-title">📁 文件系统</div>
            <button class="layui-btn layui-btn-sm" onclick="this_html.demo_filesystem()">
                <i class="layui-icon layui-icon-template"></i> 文件系统演示
            </button>
            <button class="layui-btn layui-btn-sm layui-btn-normal" onclick="this_html.read_logs()">
                <i class="layui-icon layui-icon-read"></i> 读取日志
            </button>
            <button class="layui-btn layui-btn-sm layui-btn-warm" onclick="this_html.clear_logs()">
                <i class="layui-icon layui-icon-delete"></i> 清除日志
            </button>
        </div>

        <div class="operation-section">
            <div class="operation-title">🛠️ 系统操作</div>
            <button class="layui-btn layui-btn-sm" onclick="this_html.show_status()">
                <i class="layui-icon layui-icon-chart"></i> 显示状态
            </button>
            <button class="layui-btn layui-btn-sm layui-btn-warm" onclick="this_html.reset_system()">
                <i class="layui-icon layui-icon-refresh"></i> 重置系统
            </button>
        </div>
    </div>

    <div class="editor">
        <div class="editor-code">
            <textarea id="editor-code"># 中断处理演示 - 真实的长时间程序
# 这个程序会运行指定的步数，期间可以被中断

# 设置程序运行步数 (可以修改这个值)
steps = 150

print("=== 真实中断处理演示 ===")
print(f"程序将运行 {steps} 步")
print("运行期间可以点击右侧按钮触发各种中断")
print()

print("🎯 可用的中断类型:")
print("   1. SIGINT (Ctrl+C) - 用户中断")
print("   2. SIGTERM - 程序终止")
print("   3. SIGUSR1 - 用户信号1")
print("   4. SIGUSR2 - 用户信号2") 
print("   5. TIMER - 定时器中断")
print("   6. I/O - 输入输出中断")
print("   7. MEMORY - 内存中断")
print("   8. SYSCALL - 系统调用中断")
print()

print("📁 文件系统功能:")
print("   - 中断日志会自动保存到虚拟文件系统")
print("   - 可以读取和清除日志文件")
print("   - 支持Emscripten文件系统API")
print()

print("🚀 点击'运行演示'开始长时间程序")
print("💡 程序运行时可随时触发中断进行测试")
print("📊 所有中断操作都会记录到日志文件中")
print()

# 模拟一些复杂的计算任务
class DataProcessor:
    def __init__(self, size):
        self.data_size = size
        self.processed = 0
    
    def process_chunk(self):
        # 模拟数据处理
        self.processed += 1
        return self.processed < self.data_size
    
    def get_progress(self):
        return (self.processed / self.data_size) * 100

print("💻 数据处理任务准备就绪")
print("⚡ 等待程序启动...")
print()
print("提示：运行后可以在程序执行过程中测试各种中断！")
            </textarea>
        </div>
        <div class="editor-result">
            <pre id="editor-result"></pre>
        </div>
    </div>




</body>
<script src="/assets/lib/layui@2.11.4/layui.js"></script>
<script src="/assets/lib/raf@1.0.0/raf.js"></script>
<script src="/assets/lib/codemirror@5.65.18/lib/codemirror.js"></script>
<script src="/assets/lib/codemirror@5.65.18/mode/ec2/ec2.js"></script>
<script src="/assets/lib/codemirror@5.65.18/addon/lint/lint.js"></script>
<script src="/assets/lib/codemirror@5.65.18/addon/hint/show-hint.js"></script>

<script src="/assets/wasm/interrupt.m.js"></script>
<script src="/assets/js/interrupt.js"></script>


</html>