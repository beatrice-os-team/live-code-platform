# 基于洛书（Losu）编程语言与 Web Assembly 的编译与 OS 演示系统

---

## 项目简介

本项目基于洛书（Losu）编程语言与 Web Assembly 技术，打造一个集编程教学与操作系统原理演示于一体的交互式网站。用户可以在浏览器中编写 Losu 代码，体验编译、虚拟机运行、内存管理、线程调度、文件操作等底层 OS 功能的可视化过程，助力系统能力学习与创新实践。

本项目为 2025 年全国大学生计算机系统能力大赛-操作系统设计赛（全国）- OS功能挑战赛道参赛作品。

## 中断处理实验介绍

### 实验概述

中断处理是操作系统的核心机制之一，它允许系统响应外部事件和管理程序执行流程。本实验通过洛书虚拟机的协程机制和 WebAssembly 的事件处理，模拟中断处理的基本原理，帮助学生理解中断驱动的程序设计模式。

### 学习目标

- **理解中断的概念**：掌握中断在操作系统中的重要作用
- **掌握中断处理流程**：学习中断发生、处理和恢复的完整过程
- **了解协程与中断的关系**：理解协程如何模拟中断处理机制
- **体验事件驱动编程**：通过实际代码体验事件驱动的程序设计

### 实验功能

#### 1. 交互式中断触发

**支持的中断类型：**
- **SIGINT** (优先级：高) - 程序中断信号 (Ctrl+C)
- **SIGTERM** (优先级：高) - 程序终止信号
- **SIGUSR1/SIGUSR2** (优先级：普通) - 用户定义信号
- **SIGALRM** (优先级：高) - 定时器信号
- **TIMER** (优先级：高) - 时钟中断
- **I/O** (优先级：普通) - I/O操作完成中断
- **KEYBOARD** (优先级：普通) - 键盘输入中断
- **NETWORK** (优先级：普通) - 网络数据中断
- **EXCEPTION** (优先级：关键) - 异常处理中断
- **SYSCALL** (优先级：高) - 系统调用中断

**操作方式：**
1. 点击左侧面板中的中断按钮直接触发对应中断
2. 每个按钮显示中断名称、描述和优先级信息
3. 实时查看中断处理过程和系统状态变化

#### 2. 优先级管理

**优先级级别：**
- **关键 (1)** - 最高优先级，可打断所有其他中断
- **高 (2)** - 高优先级，可打断普通和低优先级中断
- **普通 (3)** - 普通优先级，可打断低优先级中断
- **低 (4)** - 最低优先级，容易被其他中断打断

**功能特性：**
- 动态调整系统当前优先级阈值
- 低优先级中断在高优先级环境下会被阻塞
- 优先级降低时自动处理待处理的中断队列

#### 3. 程序执行模拟

**模拟特性：**
- 可配置执行步数的程序运行模拟
- 在程序执行过程中自动触发各种中断
- 展示中断与程序执行的交互过程
- 支持中断导致的程序终止处理

**时序设计：**
- 每10步检查一次定时器中断
- 每25步模拟I/O操作完成
- 每50步模拟键盘输入事件
- 第15步模拟用户Ctrl+C操作

#### 4. 系统状态监控

**实时状态显示：**
- 中断系统启用/禁用状态
- 当前系统优先级设置
- 程序运行状态和计数器
- 各中断类型的启用状态和待处理状态

**统计信息：**
- 总中断处理次数
- 成功处理和被阻塞的中断数量
- 平均中断处理时间
- 中断处理栈的状态信息

#### 5. 演示场景

**场景1：中断优先级演示**
```
展示不同优先级中断的处理顺序和嵌套处理机制
```

**场景2：异常处理演示**
```
模拟除零、空指针、数组越界等异常的处理流程
```

**场景3：系统调用演示**
```
演示文件操作、内存分配、进程创建等系统调用的中断处理
```

### 技术实现

#### C语言后端 (WASM)
- **中断向量表**：定义12种不同类型的中断及其属性
- **优先级调度器**：实现基于优先级的中断调度算法
- **上下文管理**：使用 `setjmp/longjmp` 模拟上下文切换
- **统计模块**：记录中断处理的各种性能指标

#### JavaScript前端
- **WASM模块加载**：异步加载和初始化中断处理模块
- **交互界面**：提供直观的中断触发和状态展示界面
- **实时输出**：捕获WASM模块的stdout输出并格式化显示
- **事件绑定**：响应用户操作并调用对应的WASM函数

#### CSS样式设计
- **现代化界面**：使用渐变背景和毛玻璃效果
- **响应式布局**：支持不同屏幕尺寸的设备
- **动画效果**：按钮点击和状态变化的动画反馈
- **主题支持**：深色和浅色主题切换

### 操作指南

#### 基础操作
1. **初始化系统**：点击"初始化中断系统"开始使用
2. **触发中断**：点击左侧面板中的任意中断按钮
3. **调整优先级**：使用优先级控制按钮改变系统优先级
4. **查看状态**：点击"显示系统状态"查看详细信息

#### 高级功能
1. **程序模拟**：设置执行步数并启动程序执行模拟
2. **演示场景**：使用预设的演示脚本学习特定概念
3. **系统控制**：启用/禁用整个中断系统或特定中断类型
4. **重置系统**：恢复到初始状态重新开始实验

#### 代码编辑
1. **加载示例**：选择预设的演示代码进行学习
2. **自定义代码**：在编辑器中编写自己的中断处理逻辑
3. **实时输出**：在右侧面板查看程序执行结果
4. **主题切换**：根据个人喜好调整编辑器主题

### 学习要点

#### 中断机制理解
- **异步性质**：中断的不可预测性和异步处理特点
- **上下文切换**：程序状态的保存和恢复机制
- **优先级管理**：不同优先级中断的调度策略

#### 系统设计原则
- **响应性**：快速响应高优先级中断
- **公平性**：确保低优先级中断最终得到处理
- **可靠性**：异常情况下的系统稳定性

#### 性能优化
- **中断延迟**：减少中断响应时间
- **处理效率**：优化中断处理程序的执行速度
- **资源管理**：合理分配系统资源避免冲突

### 扩展思考

1. **实时系统设计**：如何在实时系统中保证中断响应时间？
2. **多核中断处理**：多核环境下如何分发和处理中断？
3. **虚拟化中断**：虚拟机中的中断虚拟化技术如何实现？
4. **中断与轮询**：何时使用中断机制，何时使用轮询机制？
5. **嵌入式系统**：资源受限环境下的中断处理策略？

### 实验价值

通过本中断处理实验，学习者将：
- 深入理解操作系统中断处理的工作原理
- 掌握优先级调度和上下文切换的实现技术
- 学会设计响应式和可靠的系统架构
- 了解异常处理和系统调用的内部机制
- 培养系统级编程和调试的实践能力

本实验结合理论学习和实践操作，为学习者提供了一个全面了解中断处理机制的平台，有助于建立扎实的系统编程基础。