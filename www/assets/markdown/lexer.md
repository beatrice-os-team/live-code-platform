# 基于洛书（Losu）编程语言与 Web Assembly 的编译与 OS 演示系统

---

## 项目简介

本项目基于洛书（Losu）编程语言与 Web Assembly 技术，打造一个集编程教学与操作系统原理演示于一体的交互式网站。用户可以在浏览器中编写 Losu 代码，体验编译、虚拟机运行、内存管理、线程调度、文件操作等底层 OS 功能的可视化过程，助力系统能力学习与创新实践。

本项目为 2025 年全国大学生计算机系统能力大赛-操作系统设计赛（全国）- OS功能挑战赛道参赛作品。

## 词法分析实验介绍

### 实验概述

词法分析（Lexical Analysis）是编译器的第一个阶段，也被称为扫描（Scanning）。本实验通过洛书语言编译器的词法分析器，帮助学生理解词法分析的基本原理和过程。

### 学习目标

- **理解词法分析的作用**：掌握词法分析在编译过程中的地位和作用
- **掌握词法单元识别**：学习如何将源代码字符流转换为词法单元（Token）序列
- **了解洛书语言词法规则**：熟悉洛书语言的各种词法元素
- **体验编译器实现**：通过 WebAssembly 技术在浏览器中运行真实的词法分析器

### 实验内容

#### 1. 词法单元类型

洛书语言支持以下主要词法单元类型：

**数字字面量**
- 十进制数字：`123`, `3.14159`
- 十六进制数字：`0xFF`, `0x1A2B`
- 二进制数字：`0b1010`, `0b11110000`
- 八进制数字：`0o777`, `0o644`
- 科学计数法：`1.23e-4`, `2.5E+3`
- 字符字面量：`0aA`, `0a中`

**字符串字面量**
- 双引号字符串：`"Hello World"`
- 单引号字符串：`'Losu Language'`
- 中文字符串：`"洛书编程语言"`

**标识符和关键字**
- 变量名：`variable_name`, `count`, `数量`
- 关键字：`def`, `class`, `if`, `for`, `let`, `async`, `yield`
- 软关键字：`and`, `or`, `not`, `true`, `false`

**运算符**
- 算术运算符：`+`, `-`, `*`, `/`, `**`, `%`
- 比较运算符：`==`, `!=`, `>=`, `<=`, `>`, `<`
- 逻辑运算符：`and`, `or`, `not`
- 赋值运算符：`=`, `::`, `|>`
- 特殊运算符：`&`（字符串连接）

**分隔符和标点**
- 括号：`()`, `[]`, `{}`
- 分隔符：`,`, `:`, `;`
- 其他：`.`, `::`, `->`

#### 2. 示例代码分析

**基础示例（Hello World）**
```losu
print('Hello,World!')

let a = {
    ""
}
```

**复杂示例（生产者-消费者模型）**
```losu
class Io:
    def __init__(self):
        self.queue = []
        self.startptr = 0
        self.endptr = 0
    def isempty(self):
        return self.startptr == self.endptr
    def push(self, item):
        self.queue[self.endptr] = item
        self.endptr = self.endptr + 1

async producer(io, 1, lambda x: x*x)
async customer(io, 1)
```

**词法元素演示样例**
```losu
# 不同进制的数字字面量
let decimal_num = 123       # 十进制数字
let hex_num = 0xFF          # 十六进制数字
let binary_num = 0b1010     # 二进制数字  
let float_num = 3.14159     # 浮点数

# 各种运算符
let result1 = 10 + 20       # 加法
let result2 = 2 ** 8        # 幂运算
let logic_and = true and false    # 逻辑与

# Lambda 函数
let square = lambda x: x * x
```

### 操作步骤

1. **访问词法分析页面**：在主页侧边栏点击"词法分析"进入实验页面
2. **选择示例代码**：从预设的示例中选择，或自行编写洛书代码
3. **执行词法分析**：点击"分析"按钮，系统将调用 WebAssembly 编译的词法分析器
4. **查看分析结果**：观察输出的词法单元序列，包括：
   - 词法单元类型（Token Type）
   - 词法单元值（Token Value）
   - 源代码位置信息（行号、列号）
5. **对比学习**：尝试修改代码，观察词法分析结果的变化

### 实验重点

#### 理解词法分析过程
- **字符流到Token流的转换**：观察源代码字符如何被识别为有意义的词法单元
- **词法规则的应用**：理解不同类型的词法单元是如何被识别的
- **错误处理**：观察非法字符或格式错误时的处理

#### 洛书语言特色词法元素
- **多进制数字支持**：洛书支持多种进制的数字字面量
- **中文标识符**：支持中文作为变量名和字符串
- **特殊运算符**：如字符串连接运算符`&`、管道运算符`|>`等
- **软关键字系统**：某些单词根据上下文决定是否为关键字

### 技术实现

- **WebAssembly 驱动**：词法分析器由 C 语言实现并通过 emcc 编译为 WebAssembly
- **实时分析**：在浏览器中实时执行，无需后端服务器
- **可视化输出**：清晰展示每个词法单元的类型和值
- **教学友好**：提供详细的位置信息，便于定位和理解

### 扩展思考

1. **不同语言的词法规则差异**：对比洛书语言与其他编程语言的词法规则
2. **词法分析器的实现方法**：有限状态自动机、正则表达式等
3. **性能优化**：大文件的词法分析性能考虑
4. **错误恢复策略**：词法错误时如何继续分析后续代码

通过本实验，学生将深入理解编译器的第一个阶段，为后续的语法分析、语义分析等奠定基础。